---
import { useTranslations } from '../utils/i18n';
const { lang, t: propT } = Astro.props;
const t = propT || useTranslations(lang as any);
---
<header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-border-dark px-6 py-4 lg:px-20 bg-background-dark/95 backdrop-blur sticky top-0 z-50">
  <div class="flex items-center gap-4 text-white">
    <div class="size-6 text-primary animate-pulse">
      <span class="material-symbols-outlined">terminal</span>
    </div>
    <h2 class="text-white text-lg font-bold leading-tight tracking-wider">ADRIAN_VERGEL<span class="text-primary animate-blink">_</span></h2>
  </div>
  <div class="hidden md:flex flex-1 justify-end gap-8">
    <nav class="flex items-center gap-8" aria-label="Navegación principal">
      <a class="nav-link text-slate-400 hover:text-primary transition-colors text-sm font-medium tracking-widest" href={`/${lang}`} aria-label={t('nav.home')}>{t('nav.home')}</a>
      <a class="nav-link text-slate-400 hover:text-primary transition-colors text-sm font-medium tracking-widest" href={`/${lang}/projects`} aria-label={t('nav.projects')}>{t('nav.projects')}</a>
      <a class="nav-link text-slate-400 hover:text-primary transition-colors text-sm font-medium tracking-widest" href={Astro.url.pathname === `/${lang}/` || Astro.url.pathname === `/${lang}` ? "#experience" : `/${lang}/#experience`} data-section="experience" aria-label={t('nav.experience')}>{t('nav.experience')}</a>
      <a class="nav-link text-slate-400 hover:text-primary transition-colors text-sm font-medium tracking-widest" href={Astro.url.pathname === `/${lang}/` || Astro.url.pathname === `/${lang}` ? "#contact" : `/${lang}/#contact`} data-section="contact" aria-label={t('nav.contact')}>{t('nav.contact')}</a>
    </nav>
    
    <!-- Language Switcher - Improved -->
    <div class="flex items-center gap-2 px-4 border-l border-border-dark">
      <a 
        href={lang === 'es' ? '/en' : '/es'} 
        class="flex items-center gap-2 px-3 py-1.5 rounded-lg bg-white/5 border border-white/10 hover:bg-primary/10 hover:border-primary transition-all duration-300 group"
      >
        <span class="material-symbols-outlined text-sm text-slate-500 group-hover:text-primary transition-colors">language</span>
        <span class="text-xs font-mono text-slate-400 group-hover:text-primary transition-colors font-bold">
          {lang === 'es' ? 'EN' : 'ES'}
        </span>
      </a>
    </div>

    <a 
      href="/CV_Adrian_Vergel.pdf"
      download="CV_Adrian_Vergel.pdf"
      class="flex items-center justify-center overflow-hidden rounded h-9 px-5 bg-primary/10 hover:bg-primary/20 border border-primary text-primary hover:text-white transition-all duration-300 text-xs font-bold tracking-widest uppercase"
      aria-label={t('nav.cv')}
    >
      <span class="mr-2 material-symbols-outlined text-sm" aria-hidden="true">download</span>
      {t('nav.cv')}
    </a>
  </div>
  <!-- Mobile Menu Icon -->
  <button class="md:hidden text-white" aria-label="Abrir menú de navegación">
    <span class="material-symbols-outlined" aria-hidden="true">menu</span>
  </button>
</header>

<script>
  // Dynamic active section detection
  const sections = document.querySelectorAll('section[id]');
  const navLinks = document.querySelectorAll('.nav-link');

  function setActiveLink() {
    let currentSection = '';
    
    sections.forEach(section => {
      const htmlSection = section as HTMLElement;
      const sectionTop = htmlSection.offsetTop;
      const sectionHeight = htmlSection.clientHeight;
      
      if (window.scrollY >= sectionTop - 100) {
        currentSection = section.getAttribute('id') || '';
      }
    });

    navLinks.forEach(link => {
      link.classList.remove('text-white', 'border-b-2', 'border-primary', 'pb-1', 'font-bold');
      link.classList.add('text-slate-400', 'font-medium');
      
      if (link.getAttribute('data-section') === currentSection) {
        link.classList.remove('text-slate-400', 'font-medium');
        link.classList.add('text-white', 'border-b-2', 'border-primary', 'pb-1', 'font-bold');
      }
    });
  }

  // Set active link on scroll
  window.addEventListener('scroll', setActiveLink);
  
  // Set active link on page load
  setActiveLink();
</script>
